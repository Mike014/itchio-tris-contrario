<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b0d10" />
  <title>Dialoghi con un’Eco — Terminal</title>

  <!-- Optional: monospace web fonts -->
  <link href="https://fonts.googleapis.com/css2?family=VT323&family=Special+Elite&display=swap" rel="stylesheet" />
  <link rel="icon" href="assets/logo.ico" sizes="any">

  <style>
    :root{
      --bg: #0b0d10;
      --fg: #d7e0ea;
      --muted: #8aa0b6;
      --card: #11161c;
      --accent: #58a6ff;
      --accent-2: #8b5cf6;
      --accent-3: #22d3ee;
      --border: #1f2937;
      --ok: #10b981;
      --space: 12px;
      --radius: 12px;
      --shadow: 0 8px 32px rgba(0,0,0,.35);
      --btn-h: 44px; /* touch-friendly */
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body{
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    .container{ padding: 24px; max-width: 1200px; margin: 0 auto; }
    h1{ margin: 0 0 16px 0; font-size: clamp(18px, 2.2vw, 22px); color: var(--fg); font-weight: 600; }

    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--shadow);
    }

    /* Terminal */
    #out{
      /* Dynamic height: adapts to viewport minus bars */
      height: min(60vh, calc(100vh - 260px));
      padding: 16px;
      overflow-y: auto;
      white-space: pre-wrap;
      font-size: clamp(13px, 1.6vw, 14px);
      line-height: 1.45;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      background: #0d131a;
      border-bottom: 1px solid var(--border);
    }
    /* Accessibility: treat console as live log */
    #out[role="log"]{ outline: none; }

    /* ENTITÀ font (toggled by client.js .entita-voice) */
    @font-face{
      font-family: 'Entita';
      src: url('font/entity.ttf') format('truetype');
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }
    #out.entita-voice{
      font-family: 'Entita', ui-monospace, Menlo, Consolas, monospace;
      letter-spacing: .03em;
    }

    /* Command bar (two rows) */
    #bar{
      padding: var(--space);
      background: #0f141b;
      border-bottom: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    #bar-top{
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }
    #bar-bottom{
      display: flex;
      gap: 8px;
      justify-content: center;   /* centered bottom row */
      padding-top: 8px;
      border-top: 1px dashed var(--border);
      flex-wrap: wrap;
    }

    #in{
      flex: 1 1 360px;
      height: var(--btn-h);
      padding: 0 12px;
      border: 1px solid #263241;
      border-radius: 8px;
      background: #0a0f14;
      color: var(--fg);
      outline: none;
      min-width: 220px;
    }
    #in::placeholder{ color: var(--muted); }

    button{
      height: var(--btn-h);
      padding: 0 12px;
      border: 1px solid #263241;
      border-radius: 8px;
      background: #111923;
      color: var(--fg);
      cursor: pointer;
      font-size: 14px;
    }
    button:hover{ border-color: #324559; background: #0f1822; }
    button:focus-visible{ outline: 2px solid var(--accent); outline-offset: 2px; }

    button.tris{ border-color: #3a2337; background: #1a1219; color: #ff7ab3; }
    button.tris:hover{ border-color: #5a2d50; background: #22131f; }
    button.riddle{ border-color: #3b2c7a; background: #17122a; color: #c9b6ff; }
    button.riddle:hover{ border-color: #5b47af; background: #1e1737; }
    #status{ margin-left: auto; color: var(--muted); font-size: 12px; min-height: 1em; }

    /* Panels */
    #riddles, #game-guide{
      display: none;
      padding: 16px;
      border-top: 1px dashed var(--border);
      background: #0c1218;
    }

    .riddle-wrap{
      display: grid;
      gap: 16px;
      grid-template-columns: 1fr;
    }
    @media (min-width: 720px){
      .riddle-wrap{ grid-template-columns: 1fr 1fr; }
    }
    @media (min-width: 1024px){
      .riddle-wrap{ grid-template-columns: 1fr 1fr 1fr; }
    }

    .riddle, .gamecard{
      padding: 14px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: #0a0f14;
    }
    .riddle h3, .gamecard h3{
      margin: 0 0 8px 0;
      font-size: 14px;
      font-weight: 700;
      letter-spacing: .02em;
    }
    .riddle h3{ color: var(--accent-2); }
    .gamecard h3{ color: #ff7ab3; }

    .riddle p, .gamecard p{
      margin: 0;
      color: var(--fg);
      line-height: 1.55;
      font-size: 14px;
      white-space: pre-wrap;
    }
    .gamecard ul{
      margin: 8px 0 0 18px;
      padding: 0;
      line-height: 1.5;
      font-size: 14px;
      color: var(--fg);
    }
    .hint-line{
      color: var(--muted);
      font-size: 12px;
      margin-top: 8px;
    }
    .phase-badge{
      display:inline-block; margin-bottom:6px; padding:2px 8px; border-radius:999px;
      font-size:11px; letter-spacing:.03em; font-weight:700; border:1px solid #2a3750; background:#0b1220; color:#a8c1ff;
    }
    .phase-badge.c{ border-color:#224d4a; background:#0b1716; color:#8af5e6; }
    .phase-badge.o{ border-color:#344322; background:#0f130b; color:#c4f58a; }

    .game-actions{
      margin-top: 12px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    /* Small screens: tighter vertical rhythm */
    @media (max-width: 599px){
      .container{ padding: 16px; }
      #out{ height: min(55vh, calc(100vh - 240px)); }
      #bar{ gap: 8px; }
      #bar-top{ gap: 6px; }
      button{ width: auto; }
    }

    /* Very small screens / landscape phones */
    @media (max-width: 400px){
      #in{ flex: 1 1 100%; }
      #status{ flex: 1 0 100%; text-align: right; }
      #out{ height: min(50vh, calc(100vh - 230px)); }
    }

    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce){
      * { animation: none !important; transition: none !important; }
      html { scroll-behavior: auto; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Dialoghi con un’Eco — Terminal</h1>

    <div class="card">
      <!-- Console -->
      <div id="out" role="log" aria-live="polite" aria-atomic="false" tabindex="0"></div>

      <!-- Command bar (two rows) -->
      <div id="bar" role="group" aria-label="Command bar">
        <!-- TOP ROW -->
        <div id="bar-top">
          <input id="in" placeholder='type here... (e.g. "help", "ls", "exit")' autocomplete="off" aria-label="Terminal input" />
          <button id="run"  title="Run echo.py" aria-label="Run echo.py">Run echo.py</button>
          <button id="stop" title="Stop" aria-label="Stop">Stop</button>
          <button id="btn-tris" class="tris" title="Launch Reverse Tic-Tac-Toe" aria-label="Run Reverse Tic-Tac-Toe">Run Reverse Tic-Tac-Toe</button>
          <span id="status" aria-live="polite"></span>
        </div>
        <!-- BOTTOM ROW (centered) -->
        <div id="bar-bottom">
          <button id="btn-riddles" class="riddle" title="Path E → C → O" aria-expanded="false" aria-controls="riddles">Path (E → C → O)</button>
          <button id="btn-game" class="tris" title="Show Reverse Tic-Tac-Toe rules" aria-expanded="false" aria-controls="game-guide">Reverse Tic-Tac-Toe (rules)</button>
        </div>
      </div>

      <!-- Path / Riddles Panel -->
      <div id="riddles" hidden>
        <div class="riddle-wrap">
          <!-- Phase E -->
          <div class="riddle" id="riddle-e">
            <span class="phase-badge">PHASE E • EMERGENCE</span>
            <h3>Speak to the shadow, now.</h3>
            <p>
To speak with the shadow left by the IO, listen to its whisper within the noise.
Knock where the ENTITÀ denies entry, and not just once.
Seek the footprints where memories scatter.
When interference manifests, what was hidden becomes visible
and the Echo reveals the gateway to be opened.
            </p>
            <div class="hint-line">Operational hint: summon the “noise”, insist on ENTITÀ, observe the LOST MEMORIES, then inspect everything with <code>ls -a</code> and read the key.</div>
          </div>

          <!-- Phase C -->
          <div class="riddle" id="riddle-c">
            <span class="phase-badge c">PHASE C • CONTACT</span>
            <h3>Establish contact, now.</h3>
            <p>
The gateway answers. You listen if the Echo can hear you and find where it leaves instructions.
Give a name to the fragmented IO: without a name, no contact exists.
When the greeting is understood, the next threshold prepares itself.
            </p>
            <div class="hint-line">Operational hint: ask <em>“can you hear me?”</em>, look for the handshake in <code>ls -a</code>, then declare a name with <code>set io:&lt;name&gt;</code>.</div>
          </div>

          <!-- Phase O -->
          <div class="riddle" id="riddle-o">
            <span class="phase-badge o">PHASE O • BEYOND</span>
            <h3>Receive the signal, here.</h3>
            <p>
The contact is stable. Now the Echo changes its voice and the system replies.
An external sign appears: a message that does not belong to the terminal.
If you’ve come this far, let the message reveal itself
and watch how the presence takes shape.
            </p>
            <div class="hint-line">Operational hint: upon completing contact, a diegetic notification appears and the font shifts (unlock <code>UNLOCK:O</code>).</div>
          </div>
        </div>
      </div>

      <!-- Reverse Tic-Tac-Toe Guide -->
      <div id="game-guide" hidden>
        <div class="gamecard" id="Reverse Tic-Tac-Toe">
          <h3>Reverse Tic-Tac-Toe • RULES</h3>
          <p>
In Reverse Tic-Tac-Toe, completing a three-in-a-row (a “tris”) gives the point to your OPPONENT — except in the special case of a <em>Double Trap</em>, where the player who completes the tris earns the point instead.
          </p>
          <ul>
            <li><strong>Scoring:</strong> First to <strong>3 points</strong> wins the match.</li>
            <li><strong>Flip rule:</strong> Your symbol flips each turn (X ↔ O).</li>
            <li><strong>Double Trap:</strong> If your move creates/completes two simultaneous imminent threats, you keep the point on completing the tris.</li>
            <li><strong>Modes:</strong>
              <br>1) Human vs Offensive AI
              <br>2) Random AI vs Defensive AI (demo)
              <br>3) Offensive AI vs Offensive AI (demo)
              <br>4) Benchmark (100 matches)
              <br>5) Extended Benchmark (1000)
            </li>
            <li><strong>Riddle unlock (diegetic):</strong> Win <strong>3 matches</strong> in Mode 1 (Human vs Offensive AI) to reveal the hidden “riddle resolution” screen.</li>
          </ul>
          <div class="hint-line">Operational hint: start a match from the top bar (<em>Run Reverse Tic-Tac-Toe</em>) or via the button below. Your progress toward the riddle unlock is tracked in the current session.</div>
          <div class="game-actions">
            <button id="play-triss" class="tris" title="Launch Reverse Tic-Tac-Toe now">Play now</button>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Client -->
  <script defer src="client.js"></script>
  <script>
    // Start game
    const btnTris = document.getElementById('btn-tris');
    if (btnTris) btnTris.addEventListener('click', () => {
      if (typeof start === 'function') start('/python/Tris-Al-Contrario.py');
    });

    // Toggle path/riddles visibility (with aria + hidden)
    const riddles = document.getElementById('riddles');
    const btnRiddles = document.getElementById('btn-riddles');
    btnRiddles?.addEventListener('click', () => {
      const visible = riddles.style.display === 'block';
      riddles.style.display = visible ? 'none' : 'block';
      riddles.hidden = visible;
      btnRiddles.textContent = visible ? 'Path (E → C → O)' : 'Hide path';
      btnRiddles.setAttribute('aria-expanded', String(!visible));
    });

    // Toggle Reverse Tic-Tac-Toe rules panel (with aria + hidden)
    const gameGuide = document.getElementById('game-guide');
    const btnGame = document.getElementById('btn-game');
    btnGame?.addEventListener('click', () => {
      const visible = gameGuide.style.display === 'block';
      gameGuide.style.display = visible ? 'none' : 'block';
      gameGuide.hidden = visible;
      btnGame.textContent = visible ? 'Reverse Tic-Tac-Toe (rules)' : 'Hide Reverse Tic-Tac-Toe';
      btnGame.setAttribute('aria-expanded', String(!visible));
    });

    // Internal "Play now" button
    const playBtn = document.getElementById('play-triss');
    playBtn?.addEventListener('click', () => {
      if (typeof start === 'function') start('/python/Tris-Al-Contrario.py');
    });
  </script>

  <noscript style="color:#fff; position:fixed; inset:0; display:grid; place-items:center; background:#000a;">
    <div>This terminal requires JavaScript to be enabled.</div>
  </noscript>
</body>
</html>
